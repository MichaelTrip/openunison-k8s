---
apiVersion: openunison.tremolo.io/v1
kind: Application
metadata:
  name: k8s-login-tokens
  namespace: {{ .Release.Namespace }}
spec:
  azTimeoutMillis: 3000
  isApp: true
  urls:
  - hosts:
    - "#[OU_HOST]"
    filterChain:
    - className: com.tremolosecurity.scalejs.token.ws.ScaleToken
      params:
        displayNameAttribute: "sub"
        frontPage.title: "Kubernetes kubectl command"
        frontPage.text: "Use this kubectl command to set your user in .kubectl/config"
        uidAttributeName: uid
        logoutURL: "/logout"
        homeURL: "/scale/"
        warnMinutesLeft: "5"
        tokenClassName: "com.tremolosecurity.scalejs.KubectlTokenLoader"
        kubectlUsage: "Run the kubectl command to set your user-context and server connection"
        {{ if .Values.enable_impersonation  }}
        k8sCaCertName: "#[K8S_API_SERVER_CERT:unison-ca]"
        {{ else }}
        k8sCaCertName: "#[K8S_API_SERVER_CERT:k8s-master]"
        {{ end }}
        unisonCaCertName: "unison-ca"
        kubectlTemplate: "#[K8S_CLUSTER_NAME:kubernetes]"
        kubectlWinUsage: "#[K8S_URL]"
    uri: /k8slogin/token
    azRules:
    - scope: dn
      constraint: o=Tremolo
    authChain: oauth2jwt-login
  cookieConfig:
    sessionCookieName: tremolosession
    domain: "#[OU_HOST]"
    secure: true
    httpOnly: true
    logoutURI: "/logout"
    keyAlias: session-unison
    timeout: {{ .Values.network.session_inactivity_timeout_seconds }}
    scope: -1
    cookiesEnabled: false
    